#include "bsp.h"
#include "usb.h"
#include <stdlib.h>
#include <string.h>

USBCB usbcb;

//volatile INT8U t_dev_desc[18]={0X12, 0x01,0x00,0x02,0x00,0x00,0x00,0x40,0xda,0x0b,0x34,0x12,0x00,0x20,0x00,0x00,0x00,0x01 };


const struct usb_device_descriptor device_desc = {
    .bLength =		sizeof(device_desc),
    .bDescriptorType =	USB_DT_DEVICE,
    .bcdUSB =		0x0200,
    .bDeviceClass =		USB_CLASS_PER_INTERFACE,
    .bDeviceSubClass =      0, 
    .bDeviceProtocol =      0, 
    .bMaxPacketSize0 =      ep0_mps, 
#ifdef CONFIG_USB_BULK_TEST 
    .idVendor =		0x0BDA,//0xDA0B, 
    .idProduct =	0x5678,//0x7286,
#else 
    .idVendor =		0x0BDA,//Realtek Semiconductor Corp.  
    .idProduct =	0x5678,//0x8168,
    //.idVendor =		0x03EE,//Mitsumi USB Floppy.  
    //.idProduct =	0x6901,//0x7286,
#endif 
    .bcdDevice =            0x0100,//0x0001, 
    .iManufacturer =	STRING_MANUFACTURER, 
    .iProduct =		STRING_PRODUCT, 
    .iSerialNumber =	STRING_SERIAL, 
    .bNumConfigurations =	1, 
};

const INT16U usb_sector_size[3] = {512, 2048, 512};

const INT8U descriptors_bulk[32] = { 0x09, 0x02, 0x20, 0x00, 0x01, 0x01, 0x00, 0xa0,0xa0, 0x09, 0x04, 0x00, 0x00, 0x02, 0xff, 0xff, 0x00, 0x00, 0x07, 0x05, 0x81, 0x02, 0x00, 0x02, 0x00, 0x07, 0x05, 0x02, 0x02, 0x00, 0x02, 0x00 };
//CBI testing
const INT8U descriptors_cbi[39] = { 0x09, 0x02, 0x27, 0x00, 0x01, 0x01, 0x00, 0xC0, 0x32, 0x09, 0x04, 0x00, 0x00, 0x03, 0x08, 0x04, 0x01, 0x00, 0x07, 0x05, 0x81, 0x02, 0x00, 0x02, 0x00, 0x07, 0x05, 0x02, 0x02, 0x00, 0x02, 0x00, 0x07, 0x05, 0x83, 0x03, 0x02, 0x00, 0xFF };
//const INT8U descriptors_cbi[32] = { 0x09, 0x02, 0x20, 0x00, 0x01, 0x01, 0x00, 0xC0, 0x32, 0x09, 0x04, 0x00, 0x00, 0x02, 0x08, 0x04, 0x01, 0x00, 0x07, 0x05, 0x81, 0x02, 0x00, 0x02, 0x00, 0x07, 0x05, 0x02, 0x02, 0x00, 0x02, 0x00 };

const INT8U other_speed[32] =  { 0x09, 0x07, 0x20, 0x00, 0x01, 0x01, 0x00, 0xC0, 0x32, 0x09, 0x04, 0x00, 0x00, 0x02, 0x08, 0x06, 0x50, 0x00, 0x07, 0x05, 0x81, 0x02, 0x40, 0x00, 0x00, 0x07, 0x05, 0x02, 0x02, 0x40, 0x00, 0x00 };


const INT8U str0[] = { 0x04, 0x03, 0x09, 0x04 };
const INT8U str1[] = { 0x10 , 0x03, 'R', 0x00, 'e', 0x00, 'a', 0x00, 'l', 0x00, 't', 0x00, 'e', 0x00, 'k', 0x00 };
const INT8U str2[] = { 0x20 , 0x03, 'U', 0x00, 'S', 0x00, 'B', 0x00, ' ', 0x00, 'G', 0x00, 'P', 0x00, 'I', 0x00, 'O', 0x00, 'B', 0x00, 'O', 0x00, 'A', 0x00, 'R', 0x00, 'D', 0x00, 'E', 0x00, 'R', 0x00 };

const INT8U str3[][32] = {{ 0x1C , 0x03, '0', 0x00, '3', 0x00, '5', 0x00, '7', 0x00, '8', 0x00, '0', 0x00, '2', 0x00, '1', 0x00, '1', 0x00, '5', 0x00, '9', 0x00, '4', 0x00, '6', 0x00 }, { 0x1A , 0x03, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00 }, {0x1C, 0x03, 'R', 0x00, 'T', 0x00, 'L', 0x00, '8', 0x00, '1', 0x00, '1', 0x00, '1', 0x00, 'D', 0x00, 'P', 0x00, 'D', 0x00, 'A', 0x00, 'S', 0x00, 'H', 0x00}};
//const INT8U str3[][32] = {{ 0x1C , 0x03, '0', 0x00, '3', 0x00, '5', 0x00, '7', 0x00, '8', 0x00, '0', 0x00, '2', 0x00, '1', 0x00, '1', 0x00, '5', 0x00, '9', 0x00, '4', 0x00, '6', 0x00 }, { 0x1A , 0x03, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00, 0x23, 0x00 }, {0x1C, 0x03, 'D', 0x00, 'E', 0x00, 'A', 0x00, 'D', 0x00, 'B', 0x00, 'E', 0x00, 'E', 0x00, 'F', 0x00, '0', 0x00, '1', 0x00, '2', 0x00, '3', 0x00, '4', 0x00}};

const INT8U Device_Qualifier[] = { 0x0A , 0x06, 0x00, 0x02, 0x00, 0x00, 0x00, 0x40, 0x01, 0x00 };
//0xE -> RBC  //removable bit, tom 0514
const INT8U inquiry_data[3][36] = {{ 0x00, 0x80, 0x04, 0x02, 0x20, 0x00, 0x00, 0x00, 'R', 'e', 'a', 'l', 't', 'e', 'k', ' ', 'U', 'S', 'B', ' ', 'D', 'I', 'S', 'K', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', '2', '.', '0', '0'},
    { 0x05, 0x80, 0x00, 0x32, 0x5B, 0x00, 0x00, 0x00, 'R', 'e', 'a', 'l', 't', 'e', 'k', ' ', 'U', 'S', 'B', ' ', 'C', 'D', '-', 'R', 'O', 'M', ' ', ' ', ' ', ' ', ' ', ' ', '2', '.', '0', '0'},
    { 0x00, 0x80, 0x00, 0x01, 0x20, 0x00, 0x00, 0x00, 'R', 'e', 'a', 'l', 't', 'e', 'k', ' ', 'F', 'L', 'O', 'P', 'P', 'Y', ' ', 'D', 'R', 'I', 'V', 'E', ' ', ' ', ' ', ' ', '2', '.', '0', '0'}
};

INT8U const iso_toc[] = {0x00,0x00,0x00,0x14,0x00,0x12,0x01,0x01,0x00,0x14,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0xAA,0x00,0x00,0x09,0xCC,0x50};
 
INT8U const iso_conf[] = {0x00,0x00,0x00,0x0C,0x00,0x00,0x00,0xb0,0x00,0x00,0x00,0x10,0x00,0x00,0x03,0x08};

//INT8U const toc_data[2][20] = { 0x00, 0x0A, 0x01, 0x01, 0x00, 0x14, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00};
//INT8U const toc_data[20] = {0x00, 0x12, 0x01, 0x01, 0x00, 0x14, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0xAA, 0x00, 0x00, 0x05, 0x77, 0xD3};
//INT8U const toc_data[2][21] = {{0x14, 0x00, 0x12, 0x01, 0x01, 0x00, 0x14, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x14, 0xAA, 0x00, 0x00, 0x15, 0xB4, 0x70}, { 0x0C, 0x00, 0x0A, 0x01, 0x01, 0x00, 0x14, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00}};

INT8U const mode_sense[18] = {0x00, 0x26, 0x94, 0x00, 0x00, 0x00, 0x00, 0x00, 0x05, 0x1E, 0x01, 0xF4, 0x02, 0x12, 0x02, 0x00, 0x00, 0x50 };
//INT8U const disc_info[42] =  { 0x00, 0x28, 0x0E, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x01, 0x01};
INT8U const disc_info[34] =  { 0x00, 0x20, 0x0E, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

INT8U const disc_sense[40] = { 0x00, 0x20, 0x41, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2A, 0x18, 0x3F, 0x00, 0x71, 0x73, 0x29, 0x23, 0x2B, 0x48, 0x01, 0x00, 0x01, 0x00, 0x2B, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00 };

//DVD-ROM MMC-2 spec.
INT8U const disc_conf[140] = { 0x00, 0x00, 0x00, 0x88, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x03, 0x08, 0x00, 0x10, 0x01, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x01, 0x03, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x04, 0x29, 0x00, 0x00, 0x00, 0x00, 0x10, 0x01, 0x08, 0x00, 0x00, 0x08, 0x00, 0x00, 0x10, 0x01, 0x00, 0x00, 0x1D, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x05, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x2A, 0x00, 0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x2B, 0x01, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,0x01, 0x00, 0x01, 0x00, 0x03, 0x00, 0x01, 0x03, 0x00, 0x04, 0x07, 0x00, 0x01, 0x00, 0x01, 0x05, 0x03, 0x00, 0x01, 0x06, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x08, 0x00, 0x00, 0x00, 0x01, 0x0B, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01};

//INT8U const disc_conf[140] = {0x00, 0x00, 0x00, 0x88, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x03, 0x08, 0x00, 0x10, 0x00, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00, 0x01, 0x03, 0x04, 0x00, 0x00, 0x00, 0x02, 0x00, 0x02, 0x03, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x04, 0x29, 0x00, 0x00, 0x00, 0x00, 0x10, 0x01, 0x08, 0x00, 0x00, 0x08, 0x00, 0x00, 0x01, 0x01, 0x00, 0x00, 0x1D, 0x01, 0x00, 0x00, 0x1E, 0x05, 0x04, 0x03, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x04, 0x04, 0x00, 0x00, 0x01, 0x00, 0x00, 0x2A,  0x00, 0x04, 0x00, 0x01, 0x00, 0x00, 0x00, 0x2B, 0x00, 0x04, 0x00,  0x00, 0x00, 0x00, 0x00, 0x3B, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x03, 0x00, 0x01, 0x03, 0x00, 0x04, 0x07, 0x00, 0x01, 0x00, 0x01, 0x05, 0x03, 0x00, 0x01, 0x06, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01, 0x01, 0x07, 0x0D, 0x04, 0x08, 0x00, 0x00, 0x00, 0x01, 0x0B, 0x00, 0x04, 0x00, 0x00, 0x00, 0x01 };

#ifdef CONFIG_EHCI_INTEP
//HID composite device, HID : intnum0=keyboard[EP4] + intnum1=mouse[EP5]
const INT8U descriptors_cbi_hid[59] = { 
	0x09, 0x02, 0x3B/*len*/, 0x00, 0x02/*int_num*/, 0x01, 0x00, 0xA0, 0x3C, 
	0x09, 0x04, 0x00, 0x00, 0x01, 0x03, 0x01, 0x01, 0x00, 0x09, 0x21, 0x11, 0x01, 0x00, 0x01, 0x22, 0x3E, 0x00, 0x07, 0x05, 0x84/*ep4*/, 0x03, 0x08, 0x00, 0x0A, 
	0x09, 0x04, 0x01, 0x00, 0x01, 0x03, 0x01, 0x02, 0x00, 0x09, 0x21, 0x11, 0x01, 0x00, 0x01, 0x22, /*0x82*/0x4a, 0x00, 0x07, 0x05, 0x85/*ep5*/, 0x03, 0x07, 0x00, 0x0A };
//HID keyboard report type0
INT8U device_report_type0[62] = { 0x05, 0x01, 0x09, 0x06, 0xA1, 0x01, 0x05, 0x07, 0x19, 0xE0, 0x29, 0xE7, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x08, 0x81, 0x02, 0x95, 0x01, 0x75, 0x08, 0x81, 0x01, 0x95, 0x03, 0x75, 0x01, 0x05, 0x08, 0x19, 0x01, 0x29, 0x03, 0x91, 0x02, 0x95, 0x05, 0x75, 0x01, 0x91, 0x01, 0x95, 0x06, 0x75, 0x08, 0x26, 0xFF, 0x00, 0x05, 0x07, 0x19, 0x00, 0x29, 0x91, 0x81, 0x00, 0xC0	};
//HID mouse report type1
//INT8U device_report_type1[130] = { 0x05, 0x01, 0x09, 0x02, 0xA1, 0x01, 0x85, 0x01, 0x09, 0x01, 0xA1, 0x00, 0x05, 0x09, 0x19, 0x01, 0x29, 0x05, 0x15, 0x00, 0x25, 0x01, 0x95, 0x05, 0x75, 0x01, 0x81, 0x02, 0x95, 0x01, 0x75, 0x03, 0x81, 0x01, 0x05, 0x01, 0x09, 0x30, 0x09, 0x31, 0x09, 0x38, 0x15, 0x81, 0x25, 0x7F, 0x75, 0x08, 0x95, 0x03, 0x81, 0x06, 0xC0, 0x05, 0xFF, 0x09, 0x02, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01, 0xB1, 0x22, 0x75, 0x07, 0x95, 0x01, 0xB1, 0x01, 0xC0, 0x05, 0x01, 0x09, 0x80, 0xA1, 0x01, 0x85, 0x02, 0x05, 0x01, 0x19, 0x81, 0x29, 0x83, 0x15, 0x00, 0x25, 0x01, 0x95, 0x03, 0x75, 0x01, 0x81, 0x06, 0x95, 0x01, 0x75, 0x05, 0x81, 0x01, 0xC0, 0x05, 0x0C, 0x09, 0x01, 0xA1, 0x01, 0x85, 0x03, 0x19, 0x00, 0x2A, 0x3C, 0x02, 0x15, 0x00, 0x26, 0x3C, 0x02, 0x95, 0x01, 0x75, 0x10, 0x81, 0x00, 0xC0 };

#if 0
INT8U device_report_type1[134] = { 0x05, 0x01, 0x09, 0x02, 0xA1, 0x01, 0x85, 0x01, 0x09, 0x01, 0xA1, 0x00, 0x05, 0x09, 0x19, 0x01, 0x29, 0x05, 0x15, 0x00, 0x25, 0x01, 0x95, 0x05, 0x75, 0x01, 0x81, 0x02, 0x95, 0x01, 0x75, 0x03, 0x81, 0x01, 0x05, 0x01, 
	0x09, 0x30, 0x09, 0x31, /*0x09, 0x38, 0x15, 0x81, 0x25, 0x7F, 0x75, 0x08, 0x95, 0x03, 0x81, 0x06,*/
	0x35, 0x00, 0x46, 0xFF, 0x03, 0x15, 0x00, 0x26, 0xFF, 0x03, 0x75, 0x10, 0x95, 0x02, 0x81, 0x02,
	0xC0, 0x05, 0xFF, 0x09, 0x02, 0x15, 0x00, 0x25, 0x01, 0x75, 0x01, 0x95, 0x01, 0xB1, 0x22, 0x75, 0x07, 0x95, 0x01, 0xB1, 0x01, 0xC0, 0x05, 0x01, 0x09, 0x80, 0xA1, 0x01, 0x85, 0x02, 0x05, 0x01, 0x19, 0x81, 0x29, 0x83, 0x15, 0x00, 0x25, 0x01, 0x95, 0x03, 0x75, 0x01, 0x81, 0x06, 0x95, 0x01, 0x75, 0x05, 0x81, 0x01, 0xC0, 0x05, 0x0C, 0x09, 0x01, 0xA1, 0x01, 0x85, 0x03, 0x19, 0x00, 0x2A, 0x3C, 0x02, 0x15, 0x00, 0x26, 0x3C, 0x02, 0x95, 0x01, 0x75, 0x10, 0x81, 0x00, 0xC0 };
	#endif
#endif	

INT8U device_report_type1[] =
    {0x05, 0x01, /* Usage Page (Generic Desktop)             */ 
     0x09, 0x02, /* Usage (Mouse)                            */ 
     0xA1, 0x01, /* Collection (Application)                 */ 
     0x09, 0x01, /*  Usage (Pointer)                         */ 
     0xA1, 0x00, /*  Collection (Physical)                   */ 
     0x85, 0x01,  /*   Added Report ID ... 0x01 must precede the sent data*/ 
     0x05, 0x09, /*      Usage Page (Buttons)                */ 
     0x19, 0x01, /*      Usage Minimum (01)                  */ 
     0x29, 0x03, /*      Usage Maximum (03)                  */ 
     0x15, 0x00, /*      Logical Minimum (0)                 */ 
     0x25, 0x01, /*      Logical Maximum (1)                 */ 
     0x95, 0x03, /*      Report Count (3)                    */ 
     0x75, 0x01, /*      Report Size (1)                     */ 
     0x81, 0x02, /*      Input (Data, Variable, Absolute)    */ 
     0x95, 0x01, /*      Report Count (1)                    */ 
     0x75, 0x05, /*      Report Size (5)                     */ 
     0x81, 0x01, /*      Input (Constant)    ;5 bit padding  */ 
     0x05, 0x01, /*      Usage Page (Generic Desktop)        */ 
     0x09, 0x30, /*      Usage (X)                           */ 
     0x09, 0x31, /*      Usage (Y)                           */ 
     0x35, 0x00,  /*     Physical minimum  = 0 */ 
     0x46, 0xff,0x03, /*Physical max = 1023*/ 
     0x15, 0x00, /*      Logical Minimum (0)              */ 
     0x26, 0xff,0x03, /*  logical Maximum = 1023            */ 
     0x75, 0x10, /*      Report Size (16)                     */ 
     0x95, 0x02, /*      Report Count (2)                    */ 
     0x81, 0x02, /*      Input (Data, Variable, 06-Relative, 02-Absolute)    */ 
     0x09, 0x38, /*    Wheel                         */ 
     0x35, 0x00,  /*     Physical minimum  = 0 */ 
     0x45, 0x00,  /*     Physical maximum  = 0 */ 
     0x15, 0x81, /*      Logical Minimum (-127)              */ 
     0x25, 0x7F, /*      Logical Maximum (127)               */ 
     0x75, 0x08, /*      Report Size (8)                     */ 
     0x95, 0x01, /*      Report Count (1)                    */ 
     0x81, 0x06, /*      Input (Data, Variable, 06-Relative, 02-Absolute)    */ 
     0xC0, 0xC0/*         End Collection ,End Collection      */ ,
     /*
     0x05, 0xFF
      
     0x09, 0x02, 
     0x15, 0x00, 
     0x25, 0x01, 
     0x75, 0x01,
     0x95, 0x01,
     0xB1, 0x22, 
     0x75, 0x07, 
     0x95, 0x01, 
     0xB1, 0x01, 
     0xC0, 0x05, 
     0x01, 0x09, 0x80, 0xA1, 0x01, 0x85, 0x02, 0x05, 0x01, 0x19, 0x81, 0x29, 0x83, 0x15, 0x00, 0x25, 0x01, 0x95, 0x03, 0x75, 0x01, 0x81, 0x06, 0x95, 0x01, 0x75, 0x05, 0x81, 0x01, 0xC0, 0x05, 0x0C, 0x09, 0x01, 0xA1, 0x01, 0x85, 0x03, 0x19, 0x00, 0x2A, 0x3C, 0x02, 0x15, 0x00, 0x26, 0x3C, 0x02, 0x95, 0x01, 0x75, 0x10, 0x81, 0x00, 0xC0*/
};

void usb_desc_init()
{
    #ifdef CONFIG_EHCI_INTEP
    INT8U *usbdesc = malloc(1024);//org malloc(512)
    #else
    INT8U *usbdesc = malloc(512);
    #endif

    usbcb.status = malloc(8);
    memset(usbcb.status, 0, 8);

    usbcb.config = malloc(8);
    memset(usbcb.config, 0, 8);

    memcpy(usbdesc, &device_desc, sizeof(device_desc));
    usbcb.dtresponse[USB_DT_DEVICE].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_DEVICE].len = sizeof(device_desc);

    usbdesc += 32;
    memcpy(usbdesc, descriptors_bulk, sizeof(descriptors_bulk));
    usbcb.dtresponse[USB_DT_BULK].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_BULK].len = sizeof(descriptors_bulk);

    usbdesc += 32;
    memcpy(usbdesc, descriptors_cbi, sizeof(descriptors_cbi));
    usbcb.dtresponse[USB_DT_CBI].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_CBI].len = sizeof(descriptors_cbi);

#ifdef CONFIG_EHCI_INTEP
    usbdesc += 64;
    memcpy(usbdesc, descriptors_cbi_hid, sizeof(descriptors_cbi_hid));
    usbcb.dtresponse[USB_DT_CONF_HID].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_CONF_HID].len = sizeof(descriptors_cbi_hid);
#endif

    usbdesc += 64;

    usbcb.dtresponse[USB_DT_CONFIG].ptr = usbcb.dtresponse[USB_DT_BULK].ptr;
    usbcb.dtresponse[USB_DT_CONFIG].len = usbcb.dtresponse[USB_DT_BULK].len;

    memcpy(usbdesc, str0, sizeof(str0));
    usbcb.dtresponse[USB_DT_STRING].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_STRING].len = 0;

    usbdesc += 32;
    memcpy(usbdesc, str1, sizeof(str1));

    usbdesc += 32;
    memcpy(usbdesc, str2, sizeof(str2));

    usbdesc += 32;
    memcpy(usbdesc, str3[0], sizeof(str3[0]));

    usbdesc += 32;
    memcpy(usbdesc, str3[1], sizeof(str3[1]));

    usbdesc += 32;
    memcpy(usbdesc, str3[2], sizeof(str3[2]));

    usbdesc += 32;
    memcpy(usbdesc, Device_Qualifier, sizeof(Device_Qualifier));
    usbcb.dtresponse[USB_DT_QUALIFIER].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_QUALIFIER].len = sizeof(Device_Qualifier);

    usbdesc += 32;
    memcpy(usbdesc, other_speed, sizeof(other_speed));
    usbcb.dtresponse[USB_DT_OTHERSPEED].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_OTHERSPEED].len = sizeof(other_speed);

#ifdef CONFIG_EHCI_INTEP
    usbdesc += 64;
    memcpy(usbdesc, device_report_type0, sizeof(device_report_type0));
    usbcb.dtresponse[USB_DT_CONF_KEYBOARD].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_CONF_KEYBOARD].len = sizeof(device_report_type0);
    
    usbdesc += 64;    
    memcpy(usbdesc, device_report_type1, sizeof(device_report_type1));
    usbcb.dtresponse[USB_DT_CONF_MOUSE].ptr = usbdesc;
    usbcb.dtresponse[USB_DT_CONF_MOUSE].len = sizeof(device_report_type1);
#endif

}
